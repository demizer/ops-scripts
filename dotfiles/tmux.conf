set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults for tmux (https://github.com/tmux-plugins/tmux-sensible)
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'christoomey/vim-tmux-navigator'

# set the default TERM
set -g default-terminal "${TERM}"

# tell Tmux that outside terminal supports true color
set -g terminal-overrides ",xterm-256color:Tc,xterm-kitty:RGB"

# Automatic save and restore
# set -g @continuum-restore 'on'

# tmux-resurrect for neovim, uses tpope/vim-obsession plugin
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-dir '~/.tmux_resurrect'

# Start window numbering at 1 instead of 0
set -g base-index 1

# kill everything
bind C-k confirm-before kill-server

# Use vim keys in copy mode
set -g xterm-keys on # for vim
set -g mode-keys vi # vi key

bind v split-window -h
bind s split-window -v

bind J resize-pane -D 7
bind K resize-pane -U 7
bind H resize-pane -L 7
bind L resize-pane -R 7

# status bar
set -g status-justify right
set -g status-interval 5
set -g status-left-length 30
# set -g status-left '#[fg=magenta]» #[fg=blue,bold]#T#[default]'
set -g status-left '» #T#[default]'
set -g status-right '#[default]'
set -g visual-activity on

# Show activity
set -g bell-action any
set -g set-titles on
set -g set-titles-string "#S" # wm window title string (uses statusbar variables)

# setw -g monitor-activity on
setw -g visual-activity off
# setw -g window-status-current-fg white

# default statusbar colors
# set-option -g status-style dim fg=yellow,bg=white #yellow and base2
set-option -g status-style dim

# default window title colors
# set-window-option -g window-status-style fg=brightyellow,bg=default #base0 and default
set-window-option -g window-status-style dim

# active window title colors
set-window-option -g window-status-current-style fg=brightred,bg=default #orange and default
#set-window-option -g window-status-current-style bright

# pane border
set-option -g pane-border-style fg=white #base2
set-option -g pane-active-border-style fg=brightcyan #base1

# message text
set-option -g message-style fg=brightred,bg=white #orange and base2

# pane number display
set-option -g display-panes-active-colour blue #blue
set-option -g display-panes-colour brightred #orange

# clock
# set-window-option -g clock-mode-colour green #green

# bell
set-window-option -g window-status-bell-style fg=white,bg=red #base2, red
# Allow mouse wheel scrolling, from https://bbs.archlinux.org/viewtopic.php?id=204091
set -g mouse on

bind m set-option -g mouse on \; display 'Mouse: ON'
bind M set-option -g mouse off \; display 'Mouse: OFF'

bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# Smart pane switching with awareness of vim splits, used with
# vim-tmux-navigator plugin.
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?)(diff)?$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
# bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# Enable scrolling with Shift + Page Up/Down
set -ga terminal-overrides ',xterm*:smcup@:rmcup@'

# Elliminate delay when pressing escape
# http://www.johnhawthorn.com/2012/09/vi-escape-delays/
# http://unix.stackexchange.com/questions/23138/esc-key-causes-a-small-delay-in-terminal-due-to-its-alt-behavior/25638#25638
set -s escape-time 0

# tmux-yank to lemonade copy
set -g @override_copy_command 'lemonade copy'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
